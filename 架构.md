# 常见的限流策略
## 限时计数器算法
> 假设限制1分钟之内100个请求。设置一个计数器，每次请求到来的时候counter+1，当counter到达阈值并且与第一个请求间隔小于1分钟，那么说明请求数过多，需要做熔断或者降级；如果请求间隔大于1分钟，那么重置counter重新开始计数。

### 缺点
> 在1分钟临界处，可能遭到恶意请求的攻击，比如1分钟限流是100，恶意攻击可以在59秒时发送100个请求，再在下个1分钟的0秒时发送100个请求，这样瞬时的请求就能打到限流数的2倍。

#### 优化：滑动窗口
> 把1分钟划分成60秒，记录每一秒的请求数，和之前59秒请求数的总量加起来检查是否达到限流阈值，即可防止临界点流量突发的情况。

## 令牌桶限流
1. 定义一个固定大小的漏桶。 
2. 按照一定的速率往这个桶里投入令牌，如果桶满了就不再接收新投入的令牌。
3. 请求进入时需要先从桶里拿出令牌，获取令牌的请求可以继续，处理完业务逻辑后删除令牌，若请求无法获取到令牌就拒绝，等待或者降级。
4. 令牌桶有最低限额，当桶中的令牌达到最低限额时不删除令牌，以此保证足够的限流。

### 问题：令牌数量是按照请求数减少，还是按照请求包字节大小减少？

## 漏桶算法
1. 定义一个固定大小的漏桶。
2. 如果桶里没有水，则不需要流出水滴。
3. 以任意速率流出水滴，如果流入的水滴超过容量，则丢弃。

### 令牌桶和漏桶的区别
> 适用场景不同。令牌桶允许一定的突发请求，有令牌就可以处理大数据量，漏桶的目的是平滑流入速度。

